package handlers

import (
	"{{.ModulePath}}/domain/services"
	"{{.ModulePath}}/domain/utils"
	"net/http"
	"strconv"
	
	{{- if eq .Database "postgresql" }}
	"github.com/google/uuid"
	{{- end}}
	
	// --- Import dinamis berdasarkan framework ---
	{{- if eq .Framework "fiber" }}
	"github.com/gofiber/fiber/v2"
	{{- else if eq .Framework "gin" }}
	"github.com/gin-gonic/gin"
	{{- else if eq .Framework "chi" }}
	"encoding/json"
	"github.com/go-chi/chi/v5"
	{{- else if eq .Framework "echo" }}
	"github.com/labstack/echo/v4"
	{{- end}}
)

// UserHandler adalah 'Adapter' yang menerjemahkan request HTTP ke panggilan Application Service.
type UserHandler struct {
	userService *services.UserService
	validator   *utils.Validator
}

func NewUserHandler(userService *services.UserService, validator *utils.Validator) *UserHandler {
	return &UserHandler{
		userService: userService,
		validator:   validator,
	}
}

// --- Helper untuk response ---
func handleServiceError(err error) (int, map[string]string) {
	// Di sini Anda bisa memetakan error spesifik ke status code HTTP yang berbeda
	if err.Error() == "user not found" {
		return http.StatusNotFound, map[string]string{"error": err.Error()}
	}
	return http.StatusInternalServerError, map[string]string{"error": err.Error()}
}

{{/* =================== BLOK KODE UNTUK GO FIBER =================== */}}
{{- if eq .Framework "fiber" }}
func (h *UserHandler) Create(c *fiber.Ctx) error { /* ... implementasi Fiber ... */ }
func (h *UserHandler) GetByID(c *fiber.Ctx) error { /* ... implementasi Fiber ... */ }
func (h *UserHandler) GetAll(c *fiber.Ctx) error { /* ... implementasi Fiber ... */ }
func (h *UserHandler) Update(c *fiber.Ctx) error { /* ... implementasi Fiber ... */ }
func (h *UserHandler) Delete(c *fiber.Ctx) error { /* ... implementasi Fiber ... */ }
{{- end }}

{{/* =================== BLOK KODE UNTUK GIN =================== */}}
{{- if eq .Framework "gin" }}
func (h *UserHandler) Create(c *gin.Context) { /* ... implementasi Gin ... */ }
func (h *UserHandler) GetByID(c *gin.Context) { /* ... implementasi Gin ... */ }
func (h *UserHandler) GetAll(c *gin.Context) { /* ... implementasi Gin ... */ }
func (h *UserHandler) Update(c *gin.Context) { /* ... implementasi Gin ... */ }
func (h *UserHandler) Delete(c *gin.Context) { /* ... implementasi Gin ... */ }
{{- end }}

{{/* =================== BLOK KODE UNTUK CHI =================== */}}
{{- if eq .Framework "chi" }}
func (h *UserHandler) Create(w http.ResponseWriter, r *http.Request) { /* ... implementasi Chi ... */ }
// ... dan seterusnya untuk Chi
{{- end }}

{{/* =================== BLOK KODE UNTUK ECHO =================== */}}
{{- if eq .Framework "echo" }}
func (h *UserHandler) Create(c echo.Context) error { /* ... implementasi Echo ... */ }
// ... dan seterusnya untuk Echo
{{- end }}